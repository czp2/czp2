<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/index.css">
</head>

<body>
    <div class="theme-container">
        <div class="logo-box">
            <div class="logo">
                <img alt="Google" width="272" height="92" src="./imgs/googlelogo_color_272x92dp.png">
            </div>
        </div>
        <div class="search-box">
            <form id="form" action="" method="get">
                <div class="box-container">
                    <div class="box-index">
                        <div class="img-box">
                            <img height="20" src="./imgs/search.png">
                        </div>
                        <div class="input-box">
                            <input type="text" id="search" autocapitalize="off" autocomplete="off" autocorrect="off"
                                autofocus="">
                        </div>
                        <div class="img-box img-clear">
                            <img height="14" src="./imgs/clear.png">
                        </div>
                    </div>
                    <div class="search-list">
                        <div class="ul-box">
                            <div class="xtSCL"></div>
                            <ul id="ul-list"></ul>
                            <center>
                                <input class="search-btn search-confirm" value="Google 搜索" aria-label="Google 搜索"
                                    name="btnK" role="button" type="submit">
                                <input class="search-btn search-hello" value="&nbsp;手气不错&nbsp;"
                                    aria-label="&nbsp;手气不错&nbsp;" name="btnI" type="submit">
                            </center>
                        </div>
                    </div>
                </div>
            </form>
            <div class="btn-container">
                <center>
                    <input class="search-btn search-confirm" value="Google 搜索" aria-label="Google 搜索" name="btnK"
                        role="button" type="submit">
                    <input class="search-btn search-hello" value="&nbsp;手气不错&nbsp;" aria-label="&nbsp;手气不错&nbsp;"
                        name="btnI" type="submit">
                </center>
            </div>
        </div>
        <div class="blank">
            <div class="language">
                Google提供：<a href="">简体中文</a>
            </div>
        </div>
        <div class="footer">
            <a href="">关于Google</a>
            <a href="">广告</a>
            <a href="">商务</a>
            <a href="">谷歌的运作方式</a>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- <script src="//cdn.staticfile.org/jquery/3.3.1/jquery.min.js"></script> -->
    <script type="text/javascript">
        window.onload = (event) => {
            let timer = null
            let currentIndex = -1
            function toPage(q) {
                window.location = `./page.html?q=${q}`;
            }
            function getsearchlist(q) {
                if (q) {
                    $('.img-clear').css('visibility', 'visible')
                    if (timer) return
                    timer = setTimeout(() => {
                        $.ajax('https://api.haoweilai.net/search/getsearchpromote',
                            {
                                data: { q },
                                success: (res) => {
                                    if (res.data.length) {
                                        $('.box-container').addClass('bc-inputed')
                                        $('.search-list').show()
                                        let html = ''
                                        $('#ul-list li').remove()
                                        if (res.code == 200 && res.data) {
                                            res.data.forEach(item => {
                                                html += `<li>${item.data_name}</li>`
                                            });
                                            $('#ul-list').append(html)
                                        }
                                    } else {
                                        $('.box-container').removeClass('bc-inputed')
                                        $('.search-list').hide()
                                    }

                                },
                                error: (err) => {
                                    $('#ul-list li').remove()
                                },
                                complete: () => {
                                    timer = null
                                }
                            }

                        )
                    }, 300)
                } else {
                    $('.box-container').removeClass('bc-inputed')
                    $('.search-list').hide()
                    $('.img-clear').css('visibility', 'hidden')
                }
            }
            $('.search-confirm').on('click', function (e) {
                e.preventDefault()
                if ($('#search').val()) {
                    toPage($('#search').val())
                }
            })
            $('.search-hello').on('click', function (e) {
                e.preventDefault()
                toPage('hello')
            })
            $('#search').on('input', function (e) {
                getsearchlist($(this).val())
            })
            $('#search').on('click', function (e) {
                getsearchlist($(this).val())
            })
            $('#search').on('keydown', (e) => {
                if (e.key == "Enter") {
                    e.preventDefault()
                    toPage($('#search').val())
                    return
                }
                if (e.key != "ArrowDown" && e.key != "ArrowUp") return
                e.preventDefault()
                $('#ul-list li.selected').removeClass('selected')
                if (e.key == "ArrowDown") {
                    currentIndex++
                } else if (e.key == "ArrowUp") {
                    currentIndex--
                }
                if (currentIndex < 0) {
                    currentIndex = $('#ul-list').children('li').length - 1
                }
                if (currentIndex >= $('#ul-list').children('li').length) {
                    currentIndex = 0
                }
                let current = $($('#ul-list li')[currentIndex])
                current.addClass('selected')
                $('#search').val(current.text())
            })
            $('#ul-list').on('click', function (e) {
                e.preventDefault()
                if (e.target.nodeName == 'LI') {
                    $('#search').val($(e.target).text())
                    $('.box-container').removeClass('bc-active')
                    $('.box-container').removeClass('bc-inputed')
                    $('.search-list').hide()
                    // toPage($(e.target).text())
                }

            })
            $('.img-clear').on('click', function (e) {
                $('#search').val('')
                $('.box-container').removeClass('bc-active')
                $('.box-container').removeClass('bc-inputed')
                $('.search-list').hide()
                $('.img-clear').css('visibility', 'hidden')
            })
            $(document).on('click', function (e) {
                const parents = $(e.target).parents()
                let flag = true
                for (const key in parents) {
                    if (Object.hasOwnProperty.call(parents, key)) {
                        const element = parents[key];
                        if (element.id === 'form') {
                            flag = false
                        }
                    }
                }
                if (flag) {
                    $('.box-container').removeClass('bc-active')
                    $('.box-container').removeClass('bc-inputed')
                    $('.search-list').hide()
                }
            })
        };
    </script>
</body>

</html>